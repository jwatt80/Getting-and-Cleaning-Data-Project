---
title: "Code Book"
author: "James Watt"
date: "11/1/2020"
output:
  pdf_document: default
  html_document: default
---
```{r message=FALSE, warning=FALSE, include=FALSE}
library(plyr)
library(dplyr)
library(reshape2)
library(magrittr)

#imports activity labels and features .txt files
activity_labels <- read.table("./UCI HAR Dataset/activity_labels.txt")
features <- read.table("./UCI HAR Dataset/features.txt")
feat_list <- features[,2]

#Merges subject_test.txt and y_test.txt

X_test <- read.table("./UCI HAR Dataset/test/X_test.txt")
subject_test <- read.table("./UCI HAR Dataset/test/subject_test.txt")
y_test <- read.table("./UCI HAR Dataset/test/y_test.txt")

test_merge <- data.frame("subject" = subject_test[,1],
                         "activities" = y_test[,1])

#adds labels to X_test for features
colnames(X_test) <- feat_list

#merges test results to test_merge
test_full <- cbind(test_merge, X_test)

#Does the same for train data sets
X_train <- read.table("./UCI HAR Dataset/train/X_train.txt")
subject_train <- read.table("./UCI HAR Dataset/train/subject_train.txt")
y_train <- read.table("./UCI HAR Dataset/train/y_train.txt")

train_merge <- data.frame("subject" = subject_train[,1],
                         "activities" = y_train[,1])

colnames(X_train) <- feat_list
train_full <- cbind(train_merge, X_train)

### merges test and training data sets (Objective 1) ###
full <- rbind(train_full, test_full)

### selects only columns of measurement mean and standard deviations (Obj. 2) ###

subset <- full[,grepl("mean()", names(full))|grepl("std()", names(full))]
subj_activity <- rbind(train_merge, test_merge)
subset2 <- cbind(subj_activity, subset)

### adds a column of descriptive names to the activity code (Obj. 3) ###

colnames(activity_labels) <- c("activities", "activity")
subset3 <- left_join(subset2, activity_labels, by = "activities")
subset3 <- relocate(subset3, activity, .after = activities)

### replaces variable names with descriptive names (Obj. 4) ###
features <- names(subset3)
featurestop <- features[1:3]
featuresbot <- features[4:length(features)]
featuresbot %<>%
        gsub("Acc", "accelerometer ", .) %>%
        gsub("Gyro", "gyroscope ", .) %>%
        gsub("Jerk", "jerksignal ", .) %>% 
        gsub("Mag", "magnitude ", .) %>%
        gsub("^tBody", "time domain body ", .) %>%
        gsub("^fBody", "frequency domain body ", .) %>%
        gsub("Body", "", .) %>%
        gsub("^tGravity", "time domain gravity ", .) %>%
        gsub("-mean", "mean", .) %>%
        gsub("-std", "std", .) %>%
        gsub("\\()", "", .) %>%
        gsub("\\-", " ", .) %>%
        gsub("meanFreq", "mean frequency", .) %>%
        tolower() %>%
        paste("mean of", ., sep = " ")

features <- c(featurestop, featuresbot)
colnames(subset3) <- features

### calculates means of each measurement by subject and activity (Obj. 5) ###

subset6m <- melt(subset3, id.vars = c("subject", "activities", "activity"))
subset6m <- group_by(subset6m, subject, activity, variable)

mean_subset <- summarize(subset6m, mean(value)) #Long data set

mean_subsetw <- dcast(mean_subset, subject + activity ~ variable, #Wide data set
                      value.var = "mean(value)")
```

The variables in **run_analysis.R** are extracted from wearable computer data generated by the UCI Machine Learning Repository and represent movement data across three dimensions for various sensor signals from an accelerometer and gyroscope. Thirty participants wore a Samsung device and completed six activities. During these activities, repeated measurements of a total of 561 individual variables were measured or calculated by the investigators. 

For the purposes of this analysis, specific variables were extracted (described below). These extracted variables were merged with subject and activity data. These data were further reduced to the mean value of the repeated measures of each variable by subject and activity into a tidy data set for further analysis of motion parameters. 

##### Subject Variable
Subjects are numbered 1-30. Subjects 2,4,9,10,12,13,18,20 and 24 were listed in the 'test' data set; remaining subjects were listed in the 'train' data set. These were merged into the 'full' data set (see README). No further re-coding was done for the subject variable.

##### Activity Variables
Activities were numbered 1-6 and corresponding descriptive activities were listed in the 'activity_labels.txt' file. Following the full data merge (see README.md), descriptive names were added as 'activity'. The list of 'activities' codes and their respective 'activity' descriptives are:

```{r echo=FALSE}
activity_labels
```


##### Extracted Variables
The variables extracted from the measured or calculated features were those that reported a mean value or a standard deviation value (std). To extract these variables, variable names were extracted, using the **grepl()** function, from the full, merged data set (see README.md) where names included "mean()" or "std()".

```{r eval=FALSE}
subset <- full[,grepl("mean()", names(full))|grepl("std()", names(full))]
```

The extracted variables (n = 79) are as follows:

```{r echo=FALSE}
colnames(subset)
```

To clarify the variable names, the variables (features) were re-named using descriptive titles based on information from the 'features_info.txt' file provided by the data source. This was accomplished by the **gsub()** function and piping using the **magrittr** package. Special characters (e.g. '()') were eliminated; abbreviations were extended, 'time domain' and 'frequency domain' were added where appropriate; and "mean of" was appended to the front of each variable to indicate that the reported variables (transformed below) are mean values of the repeated measures. All variable names were changed to lowercase. The code follows ('featuresbot' is a vector of variable names):

```{r eval=FALSE}
featuresbot %<>%
        gsub("Acc", "accelerometer ", .) %>%
        gsub("Gyro", "gyroscope ", .) %>%
        gsub("Jerk", "jerksignal ", .) %>% 
        gsub("Mag", "magnitude ", .) %>%
        gsub("^tBody", "time domain body ", .) %>%
        gsub("^fBody", "frequency domain body ", .) %>%
        gsub("Body", "", .) %>%
        gsub("^tGravity", "time domain gravity ", .) %>%
        gsub("-mean", "mean", .) %>%
        gsub("-std", "std", .) %>%
        gsub("\\()", "", .) %>%
        gsub("\\-", " ", .) %>%
        gsub("meanFreq", "mean frequency", .) %>%
        tolower() %>%
        paste("mean of", ., sep = " ")
```

Updated variable names (n = 79) are as follows, where "x", "y", and "z" are measurements in the x, y, and z direction, respectively:

```{r echo=FALSE}
print(featuresbot)
```

##### Calculation of Mean Values

The data were first rearranged to form a *long* data set using **melt()**

```{r eval=FALSE}
subset6m <- melt(subset3, id.vars = c("subject", "activities", "activity"))
```

The data were grouped by "subject" x "activity" x "variable", where "variable" was a vector of variable names (as above). Using the **summarize()** function, the mean value of each group was calculated into a data frame named 'mean_subset'.

```{r eval=FALSE}
mean_subset <- summarize(subset6m, mean(value))
```

This generated a *long* data frame consisting of subject, activity, variable, and the mean value calculated of that variable's repeated measurement by subject and activity (4 variables). The *long* dataset **mean_subset** consists of 14220 observations.

```{r}
dim(mean_subset)
```
```{r}
head(mean_subset)
```
```{r}
tail(mean_subset)
```

To help clarify the data for spreadsheets, a *wide* dataset was generated using **dcast()**.

```{r eval=FALSE}
mean_subsetw <- dcast(mean_subset, subject + activity ~ variable,
                      value.var = "mean(value)")
```

This transformed the dataset such that each row contains the subject, activity, and every mean value calculation across the variables. The *wide* dataset **mean_subsetw** has 81 variables (subject, activity, and 79 features) and 180 observations. 

```{r}
str(mean_subsetw)
```




